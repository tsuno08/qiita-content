---
title: 過去のコードレビューから自分用のレビュアーを作る
tags:
  - GitHub
  - AI
  - LLM
private: false
updated_at: '2025-05-14T21:03:54+09:00'
id: add1439645a0ab75620e
organization_url_name: null
slide: false
ignorePublish: false
---
## はじめに

まず、VSCodeのGitHub Copilotではレビューをしてもらえる機能があります

- https://code.visualstudio.com/docs/copilot/copilot-smart-actions#_review-code

こういうやつ↓

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697143/41ee8fad-1ff3-4692-b3ce-fc8fcfa79110.png)


今回は、過去のコードレビューからカスタム指示（custom instructions）用のファイルを作成し、自分用のレビュアーを作ってみました

- https://code.visualstudio.com/docs/copilot/copilot-customization#_specify-custom-instructions-in-settings

## レビューコメントの収集

以下のようなシェルスクリプトを作成して、結果をファイルに出力します

例）`hoge.sh > hoge.txt`

- レビューコメントを詳細に取得する `gh` のコマンドが見つからなかったので、`gh api` を使用（もしかしたら現在はあるかも）
- org、repo、user、limitは個人に合わせて指定（一応、limitは1000とかでも行けました）
- 自分のコメントはノイズだったので除外するようにしてます

```bash
#!/bin/bash

org='<組織名>'
repo='<リポジトリ名>'
user='<ユーザー名>'
limit=<取得件数>

pr_numbers=$(gh pr list \
    --repo $org/$repo \
    --author $user \
    --state 'all' \
    --json number \
    --jq '.[].number' \
    --limit $limit)

for number in $pr_numbers; do
    gh api \
        -H 'Accept: application/vnd.github+json' \
        -H 'X-GitHub-Api-Version: 2022-11-28' \
        /repos/$org/$repo/pulls/$number/comments \
        --jq "
            .[]
            | select(.user.login != \"${user}\")
            | \"### [\(.id)]\n\n\`\`\`\n\(.diff_hunk)\n\`\`\`\n\n\(.body)\n\n\"
        "
    done
```

## ChatGPTに投げる

作成したファイルを添付して、CopilotやChatGPTやGeminiなどに雑に投げます

- プロンプトは雰囲気でそれっぽいのを書いてます

```markdown
あなたは優秀なバックエンドエンジニアです。参考情報を元にタスクに取り組んでください

### 参考情報
- 添付したファイルは過去のコードレビューのコメント
- 以下はGitHub Copilotのカスタム指示についてのページ
  - https://docs.github.com/ja/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot

### タスク
1. 添付ファイルを元にレビューの意図を理解する
2. レビュー内容を汎用化して整理する
3. レビュー項目としてまとめる

### フォーマット
- markdown形式にすること
- LLMが理解しやすい形式にすること
  - GitHub Copilotのカスタム指示（レビュー用）で利用する
```

ChatGPTに投げた例です。

ファイル添付しても Deep Research が使えることをこの時初めて知りました🧐

添付したファイルだけをひたすら読みまくっていて新鮮、1つの資料をしっかりと見てくれるのは色々と使い道ありそう

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697143/692b1e4e-5e59-40d1-8a1d-fa4238a7d788.png)
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/697143/c88f4436-79a8-44c9-8047-6993ecb5c07a.png)


## カスタム指示の設定

- 返ってきた内容を整理して `.github/.copilot-review-instructions.md` に追加
- VSCode の `settings.json` に `github.copilot.chat.reviewSelection.instructions` の部分を追加で完了

```json
{
	...
  "github.copilot.chat.reviewSelection.instructions": [
    {
      "file": ".copilot-review-instructions.md"
    }
  ]
}
```

## おわりに

どこまでちゃんとレビューしてくれるかはこれからのところです！

コンテキスト莫大になったり、フィルタリング結構必要になりますが、リポジトリ全体で作ってみるのも良さそうです

以上雑記事でした🙇‍♂️
少しでも参考になれば幸いです！
